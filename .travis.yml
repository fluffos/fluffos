language: cpp

before_install:
  - sudo apt-get update -qq && sudo apt-get install -qq bison libz-dev gcc-multilib g++-multilib valgrind zlib1g-dev:i386 libc6-dbg:i386

script: cd src && cp local_options.testdev local_options && ./build.FluffOS develop && make && cd testsuite && valgrind --malloc-fill=0x75 --free-fill=0x73 --track-origins=yes --leak-check=full ../driver etc/config.test -ftest && cd .. && cp local_options.testrelease local_options && ./build.FluffOS && make clean && make && cd testsuite && valgrind --malloc-fill=0x75 --free-fill=0x73 --track-origins=yes --leak-check=full ../driver etc/config.test -ftest

after_failure: tail -n 50 log/*

compiler:
  - clang
  - gcc

env:
  - COMPILER_FLAGS="-m32 -mtune=generic"
  - COMPILER_FLAGS="-m64 -mtune=generic"
